
:local content
:local IPv4
:global LastIPv4

# Getting my current IPv4 address

# via web


:global globalScriptBeforeRun;
$globalScriptBeforeRun "doUpdateExternalDNS";

# parsing the current IPv4 result
:set IPv4 [/ip cloud get public-address];

:put "EXTERNAL IP: Current IPv4 = $IPv4";
:log info "EXTERNAL IP: Current IPv4 = $IPv4";

:if (($LastIPv4 != $IPv4) || ($force = true)) do={
   :put "EXTERNAL IP: update needed!";
   :log info "EXTERNAL IP: update needed!";

    :log info "Address list updated: external-ip";
   /ip firewall address-list remove [find list~"external-ip"];
   /ip firewall address-list add list="external-ip" address=$IPv4;
   
   /ip dns static remove [/ip dns static find name=ftpserver.org];
   
   :log info "Address list updated: Static DNS of ftpserver.org";
   /ip dns static add name=ftpserver.org address=$IPv4;
 
   :set LastIPv4 $IPv4;
    
} else={
   :put "EXTERNAL IP: no update needed!"
   :log info "EXTERNAL IP: no update needed!"
}


