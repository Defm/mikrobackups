#Force sync time (awoid CHR initial clock bug)

:if ([/system resource get board-name]!="CHR") do={
    /ip cloud force-update;

} else={
    /system clock set date=JAN/01/2019
    /system clock set time=14:30:00
    /system clock set time-zone-autodetect=no
    /system clock set time-zone-name=Europe/Moscow

};

:delay 3s;


:local SafeScriptCall do={

    :if ([:len $0]!=0) do={
        :if ([:len $1]!=0) do={
            :if ([:len [/system script find name=$1]]!=0) do={

                :do {
                    :log warning "Starting script: $1";
                    :put "Starting script: $1"
                    /system script run $1;
                } on-error= {
                    :log error "FAIL Starting script: $1";
                    :put "FAIL Starting script: $1"
                };

            }
        }
    } 

}

$SafeScriptCall "doEnvironmentClearance";
$SafeScriptCall "doEnvironmentSetup";
$SafeScriptCall "doImperialMarch";
$SafeScriptCall "doCoolConsole";
$SafeScriptCall "SAT!start";

#wait some for all tunnels to come up after reboot and VPN to work

:local inf "Wait some for all tunnels to come up after reboot and VPN to work.." ;
:global globalNoteMe;
:if (any $globalNoteMe ) do={ $globalNoteMe value=$inf; }

:delay 25s;

:local sysname [/system identity get name];
:local scriptname "doStartupScript";

:local inf "$scriptname on $sysname: system restart detected" ;
:if (any $globalNoteMe ) do={ $globalNoteMe value=$inf; }

:global globalTgMessage;
:if (any $globalTgMessage ) do={ $globalTgMessage value=$inf; }
      

